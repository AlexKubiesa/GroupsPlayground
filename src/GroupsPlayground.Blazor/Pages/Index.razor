@page "/"
@using GroupsPlayground.Persistence
@using GroupsPlayground.Domain
@inject NavigationManager navigationManager

<h1>Group library</h1>

<div>
    <select @bind="@selectedIndex" name="groups" size="5">
        @for (int index = 0; index < groups.Count; index++)
        {
            var group = groups[index];
            <option style="width: 50px" value="@index">@group.Name (@group.Elements.Count)</option>
        }
    </select>
</div>

<form method="get" action="/CreateGroup">
    <button type="submit">Create</button>
</form>
<button @onclick="@RemoveSelectedGroup">Remove</button>
<button @onclick="@GoToWorkspace">Workspace</button>

@code
{
    private List<Group> groups;
    private int selectedIndex;

    protected override void OnInitialized()
    {
        using Session session = new();
        RefreshGroups(session);
    }

    private void RemoveSelectedGroup()
    {
        var group = groups[selectedIndex];
        using Session session = new();
        session.GroupRepository.RemoveGroup(group);
        session.SaveChanges();
        RefreshGroups(session);
    }

    private void RefreshGroups(Session session)
    {
        groups = session.GroupRepository.GetAllGroups();
    }

    private void GoToWorkspace()
    {
        var group = groups[selectedIndex];
        navigationManager.NavigateTo($"/GroupElementWorkspace?group={group.Id:N}");
    }
}
